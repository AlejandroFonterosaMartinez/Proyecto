<!doctype html>
<html lang=en>

<head>
    <meta charset=utf-8>
    <title>PHP Function in JavaScript Demo</title>
    <style>
        body {
            font-family: 'Lato';
            font-weight: 400;
            font-size: 1.4rem;
        }

        p {
            text-align: center;
            margin-bottom: 4rem;
        }

        #textarea {
            width: 100%;
            resize: none;
            overflow: hidden;
            min-height: 50px;
            max-height: 100px;
            line-height: 20px;
            font-size: 14px;
            padding: 10px;
            box-sizing: border-box;
        }
    </style>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>

<body>
    <button type='button' id="boton" class='btn btn-info'>Cargar</button>
    <button type='button' id="Actualizar" class='btn btn-info'>Actualizar</button>

    <div class="tabla">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th scope="col">Cod_producto</th>
                    <th scope="col">Nombre</th>
                    <th scope="col">Descripcion</th>
                    <th scope="col">Precio</th>
                    <th scope="col">Stock</th>
                    <th scope="col">Categoria</th>
                    <th scope="col">Descripcion_detallada</th>
                    <th scope="col">Destacado</th>

                </tr>
            </thead>
            <tbody class="pruebas">

            </tbody>
        </table>
    </div>
    <script>
        var editando = 0;
        var pruebas = document.getElementsByClassName('pruebas');

        function guardar(fila) {
            var elementos = fila.parentNode.children;
            var textarea = document.querySelectorAll(".texta");
            textarea.forEach(area =>  console.log(area.value));
            console.log(textarea[0].value);
            $.ajax({
                data: {
                    "cod": elementos[0].innerHTML,
                    "nombre": textarea[0].value,
                    "descripcion": textarea[1].value,
                    "precio": textarea[2].value,
                    "stock": textarea[3].value,
                    "categoria": textarea[4].value,
                    "descripcionD": textarea[5].value,
                    "destacado": textarea[6].value
                },
                method: "POST",
                url: "admin_guardar.php"
            })
                .done(function (response) {
                   console.log(response);
                });
        }
        function mostrar(fila) {
            if(editando == 0){
            editando++;
            var elementos = fila.parentNode.children;
            //console.log(elementos[1].innerHTML);
            for (let i = 1; i < 8; i++) {
                var datos = elementos[i].innerHTML;
                console.log(elementos[i].innerHTML);
                //elementos[i].innerHTML = "<input type='text' value="+ elementos[i].innerHTML + ">";
                elementos[i].innerHTML = "<textarea  id='textarea' cols='30' rows='10' class='texta'>" + elementos[i].innerHTML + "</textarea>"
                const textarea = document.getElementById("textarea");

                textarea.addEventListener("input", function () {
                    this.style.height = "auto";
                    this.style.height = (this.scrollHeight) + "px";
                });
            }
            elementos[8].innerHTML = "<button type='button' id='btn' class='btn btn-success'>Guardar</button>";
            elementos[9].innerHTML = "<button type='button' id='btn' class='btn btn-danger'>Cancelar</button>";
            elementos[8].addEventListener('click', (evento) => {
                evento.preventDefault();
                console.log(elementos[1].children.value);
                
                var botonG = elementos[8];
                guardar(botonG);
            });
        }else{
            console.log('ya se esta editando un elemento');
        }

        }

        document.getElementById('boton').addEventListener('click', function (e) {
            $.ajax({
                method: "POST",
                url: "admin_cargar.php"
            })
                .done(function (response) {
                    $("tbody.pruebas").html(response);
                    //document.getElementsByClassName('botoncito').addEventListener('click',mostrar);
                    const editButtons = document.querySelectorAll(".btn-info");
                    editButtons.forEach(editBtn => editBtn.addEventListener("click", () => mostrar(editBtn.parentNode)));
                });

        })
        document.getElementById('Actualizar').addEventListener('click', function (e) {
            $.ajax({
                method: "POST",
                url: "wrap.php"
            })
                .done(function (response) {
                    //$("tbody.pruebas").html("");
                    $("tbody.pruebas").innerHTML = "";
                    //document.getElementsByClassName('botoncito').addEventListener('click',mostrar);
                    const editButtons = document.querySelectorAll(".btn-info");
                    editButtons.forEach(editBtn => editBtn.addEventListener("click", () => mostrar(editBtn.parentNode)));
                });

        })

    </script>
</body>

</html>